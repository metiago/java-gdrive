<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
  <title>ZBX - Google Drive File Manager</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">


  <script src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

  <script src="https://apis.google.com/js/client:platform.js?onload=start" async defer></script>

  <script>

    function start() {

      gapi.load('auth2', function () {
        auth2 = gapi.auth2.init({
          client_id: '531323657514-gu1rhn8mna5ogenh89if9hcuu9mucc3e.apps.googleusercontent.com',
          // Scopes to request in addition to 'profile' and 'email'
          scope: 'https://www.googleapis.com/auth/drive.file'
        });

      });

    }

  </script>

</head>

<body>

  <nav class="light-blue lighten-1" role="navigation">
    <div class="nav-wrapper container"><a id="logo-container" href="#" class="brand-logo"></a>
      <ul class="right hide-on-med-and-down">
        <li><a href="#"></a></li>
      </ul>
      <ul id="nav-mobile" class="sidenav">
        <li><a href="#"></a></li>
      </ul>
      <a href="#" data-target="nav-mobile" class="sidenav-trigger"><i class="material-icons">menu</i></a>
    </div>
  </nav>

  <div class="section no-pad-bot" id="index-banner">
    <div class="container">
      <br><br>
      <h1 class="header center orange-text"> Google Drive File Manager </h1>
      <div class="row center">
        <h5 class="header col s12 light">This application uses the Google Drive API to manage your files</h5>
      </div>
      <div class="row center">
        <a id="signinButton" href="#" class="btn-large waves-effect waves-light orange">Get Started</a>
      </div>
      <br><br>
    </div>
  </div>


  <script>

    $('#signinButton').click(function () {
      auth2.grantOfflineAccess().then(signInCallback).catch(e => console.log(e));
    });


    function signInCallback(authResult) {

      if (authResult['code']) {

        $('#signinButton').attr('style', 'display: none');

        $.ajax({

          type: 'POST',
          url: 'http://localhost:8001/authorize/auth-code',
          // Always include an `X-Requested-With` header in every AJAX request to protect against CSRF attacks.
          headers: {
            'X-Requested-With': 'XMLHttpRequest'
          },
          contentType: 'application/json; charset=utf-8',
          success: function (result) {
            // Handle or verify the server response.
          },
          processData: false,
          data: JSON.stringify({ "code": authResult['code'] })
        });

      } else {
        console.log("Error on Google Authorization Flow.");
      }
    }

  </script>


</body>

</html>